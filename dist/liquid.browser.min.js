!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).liquidjs={})}(this,function(l){"use strict";var o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)};function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var q=function(){return(q=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,s,a,u){return new(a=a||Promise)(function(r,e){function n(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?r(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(n,i)}o((u=u.apply(t,s||[])).next())})}function x(n,i){var o,s,a,u={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(r){return function(t){var e=[r,t];if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,s=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(a=0<(a=u.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){u.label=e[1];break}if(6===e[0]&&u.label<a[1]){u.label=a[1],a=e;break}if(a&&u.label<a[2]){u.label=a[2],u.ops.push(e);break}a[2]&&u.ops.pop(),u.trys.pop();continue}e=i.call(n,u)}catch(t){e=[6,t],s=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}}}function R(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&n>=t.length?void 0:t)&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function f(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function d(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||((n=n||Array.prototype.slice.call(e,0,i))[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}u.prototype.valueOf=function(){},u.prototype.themeConfig=function(){},u.prototype.liquidMethodMissing=function(t){};var a=u;function u(){}var c=Object.prototype.toString,h=String.prototype.toLowerCase;function g(t){return"[object String]"===c.call(t)}function v(t){return"function"==typeof t}function n(t){return b(t=y(t))?"":String(t)}function y(t){return t instanceof a?t.valueOf():t}function m(t){return"number"==typeof t}function b(t){return null==t}function w(t){return"[object Array]"===c.call(t)}function T(t,e){for(var r in t=t||{})if(t.hasOwnProperty(r)&&!1===e(t[r],r,t))break;return t}function k(t){return t[t.length-1]}function E(t){var e=typeof t;return null!==t&&("object"==e||"function"==e)}function L(t,e,r){void 0===r&&(r=1);for(var n=[],i=t;i<e;i+=r)n.push(i);return n}function F(t,e,r){return D(t,e,r=void 0===r?" ":r,function(t,e){return e+t})}function D(t,e,r,n){for(var i=e-(t=String(t)).length;0<i--;)t=n(t,r);return t}function M(t){return t}function P(t){return t.replace(/(\w?)([A-Z])/g,function(t,e,r){return(e?e+"_":"")+r.toLowerCase()})}function N(t,e){return null==t&&null==e?0:null==t?1:null==e||(t=h.call(t))<(e=h.call(e))?-1:e<t?1:0}var A=function(t,e,r,n){this.key=t,this.value=e,this.next=r,this.prev=n},_=(I.prototype.write=function(t,e){this.cache[t]?this.cache[t].value=e:(e=new A(t,e,this.head.next,this.head),this.head.next.prev=e,this.head.next=e,this.cache[t]=e,this.size++,this.ensureLimit())},I.prototype.read=function(t){var e;if(this.cache[t])return e=this.cache[t].value,this.remove(t),this.write(t,e),e},I.prototype.remove=function(t){var e=this.cache[t];e.prev.next=e.next,e.next.prev=e.prev,delete this.cache[t],this.size--},I.prototype.clear=function(){this.head.next=this.tail,this.tail.prev=this.head,this.size=0,this.cache={}},I.prototype.ensureLimit=function(){this.size>this.limit&&this.remove(this.tail.prev.key)},I);function I(t,e){void 0===e&&(e=0),this.limit=t,this.size=e,this.cache={},this.head=new A("HEAD",null,null,null),this.tail=new A("TAIL",null,null,null),this.head.next=this.tail,this.tail.prev=this.head}function j(t,e){function r(t){for(var e,r,n=o,i=0;i<t.length;){if(i===t.length-1||(r=s(n,t[i]))&&(n=r.data),!n)return;i++}return e=n?function(t,e){for(var r=t,n={},i=0;i<r.length;i++)if("file"===r[i].type&&(r[i].name===e||r[i].name==="".concat(e,".liquid")||r[i].name==="".concat(e,".json"))){n=r[i].data;break}return n&&n.value}(n,t[t.length-1]):e}var o=e,s=function(t,e){for(var r={type:"folder",name:"",data:[]},n=0;n<t.length;n++)if("folder"===t[n].type){if(t[n].name===e){r=t[n];break}s(t[n].data,e)}return r},e={},t=t.split("/");return e=1<t.length?r(t):(e=e||r(["sections"].concat(t)))||r(["snippets"].concat(t))}C.prototype.getTpl=function(t){return j(t,this.rootData)};var V=C;function C(){var t=localStorage.getItem("themeData");if(!t)throw new Error("没有获取到 themeData");this.rootData=JSON.parse(t)}var z=Object.freeze({__proto__:null,resolve:function(t,e,r){return e},readFile:function(n){return s(this,void 0,void 0,function(){var e,r;return x(this,function(t){return(e=new V).rootData&&void 0!==(r=e.getTpl(n))?[2,Promise.resolve(r)]:[2,Promise.resolve("没有你的模板: ".concat(n))]})})},readFileSync:function(t){return t},exists:function(t){return s(this,void 0,void 0,function(){return x(this,function(t){return[2,!0]})})},existsSync:function(t){return!0}});function B(t){return t&&v(t.equals)}function H(t,e){return!K(t,e)}function K(t,e){return e.opts.jsTruthy?!t:!1===t||null==t}var U={"==":function(t,e){return B(t)?t.equals(e):B(e)?e.equals(t):t===e},"!=":function(t,e){return B(t)?!t.equals(e):B(e)?!e.equals(t):t!==e},">":function(t,e){return B(t)?t.gt(e):B(e)?e.lt(t):e<t},"<":function(t,e){return B(t)?t.lt(e):B(e)?e.gt(t):t<e},">=":function(t,e){return B(t)?t.geq(e):B(e)?e.leq(t):e<=t},"<=":function(t,e){return B(t)?t.leq(e):B(e)?e.geq(t):t<=e},contains:function(t,e){return!(!t||!v(t.indexOf))&&-1<t.indexOf(e)},and:function(t,e,r){return H(t,r)&&H(e,r)},or:function(t,e,r){return H(t,r)||H(e,r)}},p=[0,0,0,0,0,0,0,0,0,20,4,4,4,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,2,8,0,0,0,0,8,0,0,0,64,0,65,0,0,33,33,33,33,33,33,33,33,33,33,0,0,2,2,2,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Q=1,W=4,J=16;function Y(l){var e,t,r={};try{for(var n=R(Object.entries(l)),i=n.next();!i.done;i=n.next()){for(var o=f(i.value,2),s=o[0],h=o[1],a=r,u=0;u<s.length;u++){var c=s[u];a[c]=a[c]||{},u===s.length-1&&p[s.charCodeAt(u)]&Q&&(a[c].needBoundary=!0),a=a[c]}a.handler=h,a.end=!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r}p[160]=p[5760]=p[6158]=p[8192]=p[8193]=p[8194]=p[8195]=p[8196]=p[8197]=p[8198]=p[8199]=p[8200]=p[8201]=p[8202]=p[8232]=p[8233]=p[8239]=p[8287]=p[12288]=W;var Z={root:["."],cache:void 0,extname:"",fs:z,dynamicPartials:!0,jsTruthy:!1,trimTagRight:!1,trimTagLeft:!1,trimOutputRight:!1,trimOutputLeft:!1,greedy:!0,tagDelimiterLeft:"{%",tagDelimiterRight:"%}",outputDelimiterLeft:"{{",outputDelimiterRight:"}}",preserveTimezones:!1,strictFilters:!1,strictVariables:!1,lenientIf:!1,globals:{},keepOutputType:!1,operators:U,operatorsTrie:Y(U)};function $(t){var e;return(t=t||{}).hasOwnProperty("root")&&(t.root=G(t.root)),t.hasOwnProperty("cache")&&(e=void 0,e="number"==typeof t.cache?0<t.cache?new _(t.cache):void 0:"object"==typeof t.cache?t.cache:t.cache?new _(1024):void 0,t.cache=e),t.hasOwnProperty("operators")&&(t.operatorsTrie=Y(t.operators)),t}function G(t){return w(t)?t:g(t)?[t]:[]}t(tt,X=Error),tt.prototype.update=function(){var n,i,o,t,e,r,s=this.originalError;this.context=(t=this.token,n=f(t.getPosition(),1)[0],i=t.input.split("\n"),t=Math.max(n-2,1),o=Math.min(n+3,i.length),L(t,o+1).map(function(t){var e=t===n?">> ":"   ",r=F(String(t),String(o).length),t=i[t-1];return"".concat(e).concat(r,"| ").concat(t)}).join("\n")),this.message=(t=s.message,(e=this.token).file&&(t+=", file:".concat(e.file)),e=f(e.getPosition(),2),r=e[0],e=e[1],t+=", line:".concat(r,", col:").concat(e)),this.stack=this.message+"\n"+this.context+"\n"+this.stack+"\nFrom "+s.stack};var X,z=tt;function tt(t,e){var r=X.call(this,t.message)||this;return r.originalError=t,r.token=e,r.context="",r}t(nt,et=z);var et,rt=nt;function nt(t,e){t=et.call(this,new Error(t),e)||this;return t.name="TokenizationError",et.prototype.update.call(t),t}t(st,it=z);var it,ot=st;function st(t,e){e=it.call(this,t,e)||this;return e.name="ParseError",e.message=t.message,it.prototype.update.call(e),e}t(ct,at=z),ct.is=function(t){return"RenderError"===t.name};var at,ut=ct;function ct(t,e){e=at.call(this,t,e.token)||this;return e.name="RenderError",e.message=t.message,at.prototype.update.call(e),e}t(pt,lt=z);var lt,ht=pt;function pt(t,e){e=lt.call(this,t,e)||this;return e.name="UndefinedVariableError",e.message=t.message,lt.prototype.update.call(e),e}t(gt,ft=Error);var ft,dt=gt;function gt(t){var e=ft.call(this,"undefined variable: ".concat(t))||this;return e.name="InternalUndefinedVariableError",e.variableName=t,e}t(mt,vt=Error);var vt,yt=mt;function mt(t){var e=vt.call(this,t)||this;return e.name="AssertionError",e.message=t+"",e}wt.prototype.getRegister=function(t,e){return void 0===e&&(e={}),this.registers[t]=this.registers[t]||e},wt.prototype.setRegister=function(t,e){return this.registers[t]=e},wt.prototype.saveRegister=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.map(function(t){return[t,e.getRegister(t)]})},wt.prototype.restoreRegister=function(t){var r=this;return t.forEach(function(t){var t=f(t,2),e=t[0],t=t[1];return r.setRegister(e,t)})},wt.prototype.getAll=function(){return d([this.globals,this.environments],f(this.scopes),!1).reduce(function(t,e){return q(t,e)},{})},wt.prototype.get=function(t){var e=this.findScope(t[0]);return this.getFromScope(e,t)},wt.prototype.getFromScope=function(t,e){var n=this;return(e="string"==typeof e?e.split("."):e).reduce(function(t,e){var r=Tt(t,e);if(b(t=n.isHexColor(t)&&!r?Tt(n.hexToRgba(t),e):r)&&n.opts.strictVariables)throw new dt(e);return t},t)},wt.prototype.push=function(t){return this.scopes.push(t)},wt.prototype.pop=function(){return this.scopes.pop()},wt.prototype.bottom=function(){return this.scopes[0]},wt.prototype.findScope=function(t){for(var e=this.scopes.length-1;0<=e;e--){var r=this.scopes[e];if(t in r)return r}return t in this.environments?this.environments:this.globals},wt.prototype.isHexColor=function(t){return t&&/^#([0-9a-fA-f]{6}|[0-9a-fA-f]{3})$/.test(t)},wt.prototype.hexToRgba=function(t){var e={red:"",green:"",blue:"",alpha:""};if(this.isHexColor(t)){if(4===t.length){for(var r="#",n=1;n<4;n+=1)r+=t.slice(n,n+1).concat(t.slice(n,n+1));t=r}for(var i=[],n=1;n<7;n+=2)i.push(parseInt("0x"+t.slice(n,n+2)));e={red:"".concat(i[0]),green:"".concat(i[1]),blue:"".concat(i[2]),alpha:"".concat(1)}}return e};var bt=wt;function wt(t,e,r){void 0===t&&(t={}),void 0===e&&(e=Z),void 0===r&&(r=!1),this.scopes=[{}],this.registers={},this.sync=r,this.opts=e,this.globals=e.globals,this.environments=t}function Tt(t,e){return b(t)?t:(t=function t(e){return e&&v(e.toLiquid)?t(e.toLiquid()):e}(t),v(t[e])?t[e]():t instanceof a?t.hasOwnProperty(e)?t[e]:t.liquidMethodMissing(e):"size"===e?w(r=t)||g(r)?r.length:r.size:"first"===e?w(r=t)?r[0]:r.first:"last"===e?w(n=t)?n[n.length-1]:n.last:t[e]);var r,n}function kt(t){return!!(Pt(t)&l.TokenKind.Delimited)}function xt(t){return Pt(t)===l.TokenKind.Operator}function Ot(t){return Pt(t)===l.TokenKind.HTML}function St(t){return Pt(t)===l.TokenKind.Output}function qt(t){return Pt(t)===l.TokenKind.Tag}function Rt(t){return Pt(t)===l.TokenKind.Quoted}function Et(t){return Pt(t)===l.TokenKind.Literal}function Lt(t){return Pt(t)===l.TokenKind.Number}function Ft(t){return Pt(t)===l.TokenKind.PropertyAccess}function Dt(t){return Pt(t)===l.TokenKind.Word}function Mt(t){return Pt(t)===l.TokenKind.Range}function Pt(t){return t?t.kind:-1}l.TokenKind=void 0,(e=l.TokenKind||(l.TokenKind={}))[e.Number=1]="Number",e[e.Literal=2]="Literal",e[e.Tag=4]="Tag",e[e.Output=8]="Output",e[e.HTML=16]="HTML",e[e.Filter=32]="Filter",e[e.Hash=64]="Hash",e[e.PropertyAccess=128]="PropertyAccess",e[e.Word=256]="Word",e[e.Range=512]="Range",e[e.Quoted=1024]="Quoted",e[e.Operator=2048]="Operator",e[e.Delimited=12]="Delimited";var e=Object.freeze({__proto__:null,isDelimitedToken:kt,isOperatorToken:xt,isHTMLToken:Ot,isOutputToken:St,isTagToken:qt,isQuotedToken:Rt,isLiteralToken:Et,isNumberToken:Lt,isPropertyAccessToken:Ft,isWordToken:Dt,isRangeToken:Mt});function Nt(t,e){for(var r=!1,n=0;n<t.length;n++){var i=t[n];if(kt(i)){if(!r&&i.trimLeft){a=s=o=void 0;var o=t[n-1],s=e.greedy;if(o&&Ot(o))for(var a=s?W:J;p[o.input.charCodeAt(o.end-1-o.trimRight)]&a;)o.trimRight++}if(qt(i)&&("raw"===i.name?r=!0:"endraw"===i.name&&(r=!1)),!r&&i.trimRight){c=s=u=void 0;var u=t[n+1],s=e.greedy;if(u&&Ot(u)){for(var c=s?W:J;p[u.input.charCodeAt(u.begin+u.trimLeft)]&c;)u.trimLeft++;"\n"===u.input.charAt(u.begin+u.trimLeft)&&u.trimLeft++}}}}}_t.prototype.getText=function(){return this.input.slice(this.begin,this.end)},_t.prototype.getPosition=function(){for(var t=f([1,1],2),e=t[0],r=t[1],n=0;n<this.begin;n++)"\n"===this.input[n]?(e++,r=1):r++;return[e,r]},_t.prototype.size=function(){return this.end-this.begin};var At=_t;function _t(t,e,r,n,i){this.kind=t,this.input=e,this.begin=r,this.end=n,this.file=i}t(Vt,It=At);var It,jt=Vt;function Vt(t,e){var r=It.call(this,l.TokenKind.Number,t.input,t.begin,(e||t).end,t.file)||this;return r.whole=t,r.decimal=e,r}t(Bt,Ct=At),Bt.prototype.isNumber=function(t){for(var e=(t=void 0===t?!1:t)&&64&p[this.input.charCodeAt(this.begin)]?this.begin+1:this.begin;e<this.end;e++)if(!(32&p[this.input.charCodeAt(e)]))return!1;return!0};var Ct,zt=Bt;function Bt(t,e,r,n){var i=Ct.call(this,l.TokenKind.Word,t,e,r,n)||this;return i.input=t,i.begin=e,i.end=r,i.file=n,i.content=i.getText(),i}t(Ut,Ht=a),Ut.prototype.equals=function(t){return b(y(t))},Ut.prototype.gt=function(){return!1},Ut.prototype.geq=function(){return!1},Ut.prototype.lt=function(){return!1},Ut.prototype.leq=function(){return!1},Ut.prototype.valueOf=function(){return null};var Ht,Kt=Ut;function Ut(){return null!==Ht&&Ht.apply(this,arguments)||this}t(Jt,Qt=a),Jt.prototype.equals=function(t){return!(t instanceof Jt)&&(g(t=y(t))||w(t)?0===t.length:!!E(t)&&0===Object.keys(t).length)},Jt.prototype.gt=function(){return!1},Jt.prototype.geq=function(){return!1},Jt.prototype.lt=function(){return!1},Jt.prototype.leq=function(){return!1},Jt.prototype.valueOf=function(){return""};var Qt,Wt=Jt;function Jt(){return null!==Qt&&Qt.apply(this,arguments)||this}t($t,Yt=Wt),$t.prototype.equals=function(t){return!1===t||(!!b(y(t))||(g(t)?/^\s*$/.test(t):Yt.prototype.equals.call(this,t)))};var Yt,Zt=$t;function $t(){return null!==Yt&&Yt.apply(this,arguments)||this}var Gt,Kt=new Kt,Xt={true:!0,false:!1,nil:Kt,null:Kt,empty:new Wt,blank:new Zt},te=(t(ee,Gt=At),ee);function ee(t,e,r,n){var i=Gt.call(this,l.TokenKind.Literal,t,e,r,n)||this;return i.input=t,i.begin=e,i.end=r,i.file=n,i.literal=i.getText(),i}var re,ne={"==":1,"!=":1,">":1,"<":1,">=":1,"<=":1,contains:1,and:0,or:0},ie=(t(oe,re=At),oe.prototype.getPrecedence=function(){var t=this.getText();return t in ne?ne[t]:1},oe);function oe(t,e,r,n){var i=re.call(this,l.TokenKind.Operator,t,e,r,n)||this;return i.input=t,i.begin=e,i.end=r,i.file=n,i.operator=i.getText(),i}var se=/[\da-fA-F]/,ae=/[0-7]/,ue={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v"};function ce(t){t=t.charCodeAt(0);return 97<=t?t-87:65<=t?t-55:t-48}function le(t){for(var e="",r=1;r<t.length-1;r++)if("\\"===t[r])if(void 0!==ue[t[r+1]])e+=ue[t[++r]];else if("u"===t[r+1]){for(var n=0,i=r+2;i<=r+5&&se.test(t[i]);)n=16*n+ce(t[i++]);r=i-1,e+=String.fromCharCode(n)}else if(ae.test(t[r+1])){for(i=r+1,n=0;i<=r+3&&ae.test(t[i]);)n=8*n+ce(t[i++]);r=i-1,e+=String.fromCharCode(n)}else e+=t[++r];else e+=t[r];return e}t(fe,he=At),fe.prototype.getVariableAsText=function(){return this.variable instanceof zt?this.variable.getText():le(this.variable.getText())};var he,pe=fe;function fe(t,e,r){r=he.call(this,l.TokenKind.PropertyAccess,t.input,t.begin,r,t.file)||this;return r.variable=t,r.props=e,r}function O(t,e){if(!t)throw e=e?e():"expect ".concat(t," to be true"),new yt(e)}t(ve,de=At);var de,ge=ve;function ve(t,e,r,n,i,o){r=de.call(this,l.TokenKind.Filter,r,n,i,o)||this;return r.name=t,r.args=e,r}t(be,ye=At);var ye,me=be;function be(t,e,r,n,i,o){var s=ye.call(this,l.TokenKind.Hash,t,e,r,o)||this;return s.input=t,s.begin=e,s.end=r,s.name=n,s.value=i,s.file=o,s}t(ke,we=At);var we,Te=ke;function ke(t,e,r,n){var i=we.call(this,l.TokenKind.Quoted,t,e,r,n)||this;return i.input=t,i.begin=e,i.end=r,i.file=n,i}t(Se,xe=At),Se.prototype.getContent=function(){return this.input.slice(this.begin+this.trimLeft,this.end-this.trimRight)};var xe,Oe=Se;function Se(t,e,r,n){var i=xe.call(this,l.TokenKind.HTML,t,e,r,n)||this;return i.input=t,i.begin=e,i.end=r,i.file=n,i.trimLeft=0,i.trimRight=0,i}t(Re,qe=At);var qe,Kt=Re;function Re(t,e,r,n,i,o,s,a){t=qe.call(this,t,r,n,i,a)||this,t.trimLeft=!1,t.trimRight=!1,t.content=t.getText(),r="-"===e[0],n="-"===k(e);return t.content=e.slice(r?1:0,n?-1:e.length).trim(),t.trimLeft=r||o,t.trimRight=n||s,t}t(Fe,Ee=Kt);var Ee,Le=Fe;function Fe(t,e,r,n,i){var o=this,s=n.trimTagLeft,a=n.trimTagRight,u=n.tagDelimiterLeft,c=n.tagDelimiterRight,u=t.slice(e+u.length,r-c.length),o=Ee.call(this,l.TokenKind.Tag,u,t,e,r,s,a,i)||this,c=new Ce(o.content,n.operatorsTrie);if(o.name=c.readIdentifier().getText(),!o.name)throw new rt("illegal tag syntax",o);return c.skipBlank(),o.args=c.remaining(),o}t(Pe,De=At);var De,Me=Pe;function Pe(t,e,r,n,i,o){var s=De.call(this,l.TokenKind.Range,t,e,r,o)||this;return s.input=t,s.begin=e,s.end=r,s.lhs=n,s.rhs=i,s.file=o,s}t(_e,Ne=Kt);var Ne,Ae=_e;function _e(t,e,r,n,i){var o=n.trimOutputLeft,s=n.trimOutputRight,a=n.outputDelimiterLeft,n=n.outputDelimiterRight,a=t.slice(e+a.length,r-n.length);return Ne.call(this,l.TokenKind.Output,a,t,e,r,o,s,i)||this}je.prototype.evaluate=function(n,f){var i,o,s,a,u,c,l,h,p,d;return x(this,function(t){switch(t.label){case 0:O(n,function(){return"unable to evaluate: context not defined"}),i=[],t.label=1;case 1:t.trys.push([1,9,10,11]),o=R(this.postfix),s=o.next(),t.label=2;case 2:return s.done?[3,8]:xt(a=s.value)?[4,i.pop()]:[3,5];case 3:return u=t.sent(),[4,i.pop()];case 4:return h=t.sent(),e=n.opts.operators,r=u,h=(0,e[a.operator])(h,r,n),i.push(h),[3,7];case 5:return l=(c=i).push,[4,S(a,n,f&&1===this.postfix.length)];case 6:l.apply(c,[t.sent()]),t.label=7;case 7:return s=o.next(),[3,2];case 8:return[3,11];case 9:return h=t.sent(),p={error:h},[3,11];case 10:try{s&&!s.done&&(d=o.return)&&d.call(o)}finally{if(p)throw p.error}return[7];case 11:return[2,i[0]]}var e,r})};var Ie=je;function je(t){this.postfix=d([],f(function(e){var r,n,i,o,s,a;return x(this,function(t){switch(t.label){case 0:r=[],t.label=1;case 1:t.trys.push([1,10,11,12]),n=R(e),i=n.next(),t.label=2;case 2:if(i.done)return[3,9];if(!xt(o=i.value))return[3,6];t.label=3;case 3:return r.length&&r[r.length-1].getPrecedence()>o.getPrecedence()?[4,r.pop()]:[3,5];case 4:return t.sent(),[3,3];case 5:return r.push(o),[3,8];case 6:return[4,o];case 7:t.sent(),t.label=8;case 8:return i=n.next(),[3,2];case 9:return[3,12];case 10:return s=t.sent(),s={error:s},[3,12];case 11:try{i&&!i.done&&(a=n.return)&&a.call(n)}finally{if(s)throw s.error}return[7];case 12:return r.length?[4,r.pop()]:[3,14];case 13:return t.sent(),[3,12];case 14:return[2]}})}(t)),!1)}function S(t,e,r){if(void 0===r&&(r=!1),Ft(t)){var n=t,i=e,o=n.getVariableAsText(),s=n.props.map(function(t){return S(t,i,!1)});try{return i.get(d([o],f(s),!1))}catch(t){if(r&&"InternalUndefinedVariableError"===t.name)return null;throw new ht(t,n)}}else return Mt(t)?(o=e,r=S((s=t).lhs,o),s=S(s.rhs,o),L(+r,+s+1)):Et(t)?Xt[t.literal]:Lt(t)?(n=(n=t).whole.content+"."+(n.decimal?n.decimal.content:""),Number(n)):Dt(t)?t.getText():Rt(t)?Ve(t):void 0}function Ve(t){return le(t.getText())}r.prototype.readExpression=function(){return new Ie(this.readExpressionTokens())},r.prototype.readExpressionTokens=function(){var e,r;return x(this,function(t){switch(t.label){case 0:return(e=this.readValue())?[4,e]:[2];case 1:t.sent(),t.label=2;case 2:return this.p<this.N?(e=this.readOperator())&&(r=this.readValue())?[4,e]:[2]:[3,5];case 3:return t.sent(),[4,r];case 4:return t.sent(),[3,2];case 5:return[2]}})},r.prototype.readOperator=function(){this.skipBlank();var t=function(t,e,r,n){void 0===n&&(n=t.length);for(var i,o=r,s=e;o[t[s]]&&s<n;)(o=o[t[s++]]).end&&(i=o);return!i||i.needBoundary&&p[t.charCodeAt(s)]&Q?-1:s}(this.input,this.p,this.trie,this.p+8);if(-1!==t)return new ie(this.input,this.p,this.p=t,this.file)},r.prototype.readFilters=function(){for(var t=[];;){var e=this.readFilter();if(!e)return t;t.push(e)}},r.prototype.readFilter=function(){var t=this;if(this.skipBlank(),this.end())return null;O("|"===this.peek(),function(){return"unexpected token at ".concat(t.snapshot())}),this.p++;var e=this.p,r=this.readIdentifier();if(!r.size())return null;var n=[];if(this.skipBlank(),":"===this.peek())do{++this.p;var i=this.readFilterArg();for(i&&n.push(i);this.p<this.N&&","!==this.peek()&&"|"!==this.peek();)++this.p}while(","===this.peek());return new ge(r.getText(),n,this.input,e,this.p,this.file)},r.prototype.readFilterArg=function(){var t=this.readValue();if(t){if(this.skipBlank(),":"!==this.peek())return t;++this.p;var e=this.readValue();return[t.getText(),e]}},r.prototype.readTopLevelTokens=function(t){void 0===t&&(t=Z);for(var e=[];this.p<this.N;){var r=this.readTopLevelToken(t);e.push(r)}return Nt(e,t),e},r.prototype.readTopLevelToken=function(t){var e=t.tagDelimiterLeft,r=t.outputDelimiterLeft;return-1<this.rawBeginAt?this.readEndrawOrRawContent(t):this.match(e)?this.readTagToken(t):this.match(r)?this.readOutputToken(t):this.readHTMLToken(t)},r.prototype.readHTMLToken=function(t){for(var e=this.p;this.p<this.N;){var r=t.tagDelimiterLeft,n=t.outputDelimiterLeft;if(this.match(r))break;if(this.match(n))break;++this.p}return new Oe(this.input,e,this.p,this.file)},r.prototype.readTagToken=function(t){void 0===t&&(t=Z);var e=this.file,r=this.input,n=this.p;if(-1===this.readToDelimiter(t.tagDelimiterRight))throw this.mkError("tag ".concat(this.snapshot(n)," not closed"),n);r=new Le(r,n,this.p,t,e);return"raw"===r.name&&(this.rawBeginAt=n),r},r.prototype.readToDelimiter=function(t){for(;this.p<this.N;)if(8&this.peekType())this.readQuoted();else if(++this.p,this.rmatch(t))return this.p;return-1},r.prototype.readOutputToken=function(t){void 0===t&&(t=Z);var e=this.file,r=this.input,n=t.outputDelimiterRight,i=this.p;if(-1===this.readToDelimiter(n))throw this.mkError("output ".concat(this.snapshot(i)," not closed"),i);return new Ae(r,i,this.p,t,e)},r.prototype.readEndrawOrRawContent=function(t){for(var e,r=t.tagDelimiterLeft,n=t.tagDelimiterRight,i=this.p,o=this.readTo(r)-r.length;this.p<this.N;)if("endraw"===this.readIdentifier().getText())for(;this.p<=this.N;){if(this.rmatch(n))return e=this.p,i===o?(this.rawBeginAt=-1,new Le(this.input,i,e,t,this.file)):(this.p=o,new Oe(this.input,i,o,this.file));if(this.rmatch(r))break;this.p++}else o=this.readTo(r)-r.length;throw this.mkError("raw ".concat(this.snapshot(this.rawBeginAt)," not closed"),i)},r.prototype.mkError=function(t,e){return new rt(t,new zt(this.input,e,this.N,this.file))},r.prototype.snapshot=function(t){return void 0===t&&(t=this.p),JSON.stringify((t=this.input.slice(t),e=16,t.length>e?t.substr(0,e-3)+"...":t));var e},r.prototype.readWord=function(){return console.warn("Tokenizer#readWord() will be removed, use #readIdentifier instead"),this.readIdentifier()},r.prototype.readIdentifier=function(){this.skipBlank();for(var t=this.p;this.peekType()&Q;)++this.p;return new zt(this.input,t,this.p,this.file)},r.prototype.readHashes=function(){for(var t=[];;){var e=this.readHash();if(!e)return t;t.push(e)}},r.prototype.readHash=function(){this.skipBlank(),","===this.peek()&&++this.p;var t,e=this.p,r=this.readIdentifier();if(r.size())return this.skipBlank(),":"===this.peek()&&(++this.p,t=this.readValue()),new me(this.input,e,this.p,r,t,this.file)},r.prototype.remaining=function(){return this.input.slice(this.p)},r.prototype.advance=function(t){this.p+=t=void 0===t?1:t},r.prototype.end=function(){return this.p>=this.N},r.prototype.readTo=function(t){for(;this.p<this.N;)if(++this.p,this.rmatch(t))return this.p;return-1},r.prototype.readValue=function(){var t=this.readQuoted()||this.readRange();if(t)return t;if("["===this.peek())return this.p++,!(n=this.readQuoted())||"]"!==this.peek()?void 0:(this.p++,new pe(n,[],this.p));t=this.readIdentifier();if(t.size()){for(var e=t.isNumber(!0),r=[];;)if("["===this.peek()){e=!1,this.p++;var n=this.readValue()||new zt(this.input,this.p,this.p,this.file);this.readTo("]"),r.push(n)}else{if("."!==this.peek()||"."===this.peek(1))break;if(this.p++,!(n=this.readIdentifier()).size())break;n.isNumber()||(e=!1),r.push(n)}return!r.length&&Xt.hasOwnProperty(t.content)?new te(this.input,t.begin,t.end,this.file):e?new jt(t,r[0]):new pe(t,r,this.p)}},r.prototype.readRange=function(){this.skipBlank();var t,e,r=this.p;if("("===this.peek())return++this.p,t=this.readValueOrThrow(),this.p+=2,e=this.readValueOrThrow(),++this.p,new Me(this.input,r,this.p,t,e,this.file)},r.prototype.readValueOrThrow=function(){var t=this,e=this.readValue();return O(e,function(){return"unexpected token ".concat(t.snapshot(),", value expected")}),e},r.prototype.readQuoted=function(){this.skipBlank();var t=this.p;if(8&this.peekType()){++this.p;for(var e=!1;this.p<this.N&&(++this.p,this.input[this.p-1]!==this.input[t]||e);)e?e=!1:"\\"===this.input[this.p-1]&&(e=!0);return new Te(this.input,t,this.p,this.file)}},r.prototype.readFileName=function(){for(var t=this.p;!(this.peekType()&W)&&","!==this.peek()&&this.p<this.N;)this.p++;return new zt(this.input,t,this.p,this.file)},r.prototype.match=function(t){for(var e=0;e<t.length;e++)if(t[e]!==this.input[this.p+e])return!1;return!0},r.prototype.rmatch=function(t){for(var e=0;e<t.length;e++)if(t[t.length-1-e]!==this.input[this.p-1-e])return!1;return!0},r.prototype.peekType=function(t){return p[this.input.charCodeAt(this.p+(t=void 0===t?0:t))]},r.prototype.peek=function(t){return this.input[this.p+(t=void 0===t?0:t)]},r.prototype.skipBlank=function(){for(;this.peekType()&W;)++this.p};var Ce=r;function r(t,e,r){void 0===r&&(r=""),this.input=t,this.trie=e,this.file=r,this.p=0,this.rawBeginAt=-1,this.N=t.length}Be.prototype.write=function(t){t=!0===this.keepOutputType?y(t):n(y(t)),!0===this.keepOutputType&&"string"!=typeof t&&""===this.html?this.html=t:this.html=n(this.html)+n(t)};var ze=Be;function Be(t){this.html="",this.break=!1,this.continue=!1,this.keepOutputType=!1,this.keepOutputType=t}Ke.prototype.renderTemplates=function(e,r,n){var i,o,s,a,u,c;return x(this,function(t){switch(t.label){case 0:n=n||new ze(r.opts.keepOutputType),t.label=1;case 1:t.trys.push([1,8,9,10]),i=R(e),o=i.next(),t.label=2;case 2:if(o.done)return[3,7];s=o.value,t.label=3;case 3:return t.trys.push([3,5,,6]),[4,s.render(r,n)];case 4:return(a=t.sent())&&n.write(a),n.break||n.continue?[3,7]:[3,6];case 5:throw a=t.sent(),ut.is(a)?a:new ut(a,s);case 6:return o=i.next(),[3,2];case 7:return[3,10];case 8:return u=t.sent(),u={error:u},[3,10];case 9:try{o&&!o.done&&(c=i.return)&&c.call(i)}finally{if(u)throw u.error}return[7];case 10:return[2,n.html]}})};var He=Ke;function Ke(){}Qe.prototype.on=function(t,e){return this.handlers[t]=e,this},Qe.prototype.trigger=function(t,e){t=this.handlers[t];return!!t&&(t(e),!0)},Qe.prototype.start=function(){var t,e;for(this.trigger("start");!this.stopRequested&&(t=this.tokens.shift());)this.trigger("token",t)||qt(t)&&this.trigger("tag:".concat(t.name),t)||(e=this.parseToken(t,this.tokens),this.trigger("template",e));return this.stopRequested||this.trigger("end"),this},Qe.prototype.stop=function(){return this.stopRequested=!0,this};var Ue=Qe;function Qe(t,e){this.handlers={},this.stopRequested=!1,this.tokens=t,this.parseToken=e}function We(t){this.token=t}Ye.prototype.render=function(e){var r,n,i,o,s,a,u,c;return x(this,function(t){switch(t.label){case 0:r={},t.label=1;case 1:t.trys.push([1,6,7,8]),n=R(Object.keys(this.hash)),i=n.next(),t.label=2;case 2:return i.done?[3,5]:(a=i.value,o=r,s=a,[4,S(this.hash[a],e)]);case 3:o[s]=t.sent(),t.label=4;case 4:return i=n.next(),[3,2];case 5:return[3,8];case 6:return a=t.sent(),u={error:a},[3,8];case 7:try{i&&!i.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[2,r]}})};var Je=Ye;function Ye(t){this.hash={};var e,r,t=new Ce(t,{});try{for(var n=R(t.readHashes()),i=n.next();!i.done;i=n.next()){var o=i.value;this.hash[o.name.content]=o.value}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}}$e.prototype.render=function(t,e){var r,n,i=[];try{for(var o=R(this.args),s=o.next();!s.done;s=o.next()){var a=s.value;w(a)?i.push([a[0],S(a[1],e)]):i.push(S(a,e))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return this.impl.apply({context:e,liquid:this.liquid},d([t],f(i),!1))};var Ze=$e;function $e(t,e,r,n){this.name=t,this.impl=e||M,this.args=r,this.liquid=n}Xe.prototype.value=function(e,r){var n,i,o,s,a;return x(this,function(t){switch(t.label){case 0:return r=r||e.opts.lenientIf&&0<this.filters.length&&"default"===this.filters[0].name,[4,this.initial.evaluate(e,r)];case 1:n=t.sent(),t.label=2;case 2:t.trys.push([2,7,8,9]),i=R(this.filters),o=i.next(),t.label=3;case 3:return o.done?[3,6]:[4,o.value.render(n,e)];case 4:n=t.sent(),t.label=5;case 5:return o=i.next(),[3,3];case 6:return[3,9];case 7:return s=t.sent(),s={error:s},[3,9];case 8:try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(s)throw s.error}return[7];case 9:return[2,n]}})};var Ge=Xe;function Xe(t,r){this.filters=[];t=new Ce(t,r.options.operatorsTrie);this.initial=t.readExpression(),this.filters=t.readFilters().map(function(t){var e=t.name,t=t.args;return new Ze(e,r.filters.get(e),t,r)})}function tr(e){var t={then:function(t){return t(e)},catch:function(){return t}};return t}function er(r){var n={then:function(t,e){return e?e(r):n},catch:function(t){return t(r)}};return n}function rr(n){return(t=n)&&v(t.then)?n:(t=n)&&v(t.next)&&v(t.throw)&&v(t.return)?function r(t){var e;try{e=n.next(t)}catch(t){return er(t)}if(e.done)return tr(e.value);return rr(e.value).then(r,function(t){var e;try{e=n.throw(t)}catch(t){return er(t)}return(e.done?tr:r)(e.value)})}():tr(n);var t}function nr(t){return Promise.resolve(rr(t))}function ir(t){var e;return rr(t).then(function(t){return tr(e=t)}).catch(function(t){throw t}),e}t(ar,or=We),ar.prototype.render=function(e,r){var n,i;return x(this,function(t){switch(t.label){case 0:return[4,new Je(this.token.args).render(e)];case 1:return n=t.sent(),v((i=this.impl).render)?[4,i.render(e,r,n)]:[3,3];case 2:return[2,t.sent()];case 3:return[2]}})};var or,sr=ar;function ar(t,e,r){var n=or.call(this,t)||this,i=(n.name=t.name,r.tags.get(t.name));return n.impl=Object.create(i),n.impl.liquid=r,n.impl.parse&&n.impl.parse(t,e),n}t(lr,ur=We),lr.prototype.render=function(e,r){var n;return x(this,function(t){switch(t.label){case 0:return[4,this.value.value(e,!1)];case 1:return n=t.sent(),r.write(n),[2]}})};var ur,cr=lr;function lr(t,e){var r=ur.call(this,t)||this;return r.value=new Ge(t.content,e),r}t(fr,hr=We),fr.prototype.render=function(t,e){return x(this,function(t){return e.write(this.str),[2]})};var hr,pr=fr;function fr(t){var e=hr.call(this,t)||this;return e.str=t.getContent(),e}gr.prototype.parse=function(t){for(var e,r=[];e=t.shift();)r.push(this.parseToken(e,t));return r},gr.prototype.parseToken=function(e,t){try{return qt(e)?new sr(e,t,this.liquid):St(e)?new cr(e,this.liquid):new pr(e)}catch(t){throw new ot(t,e)}},gr.prototype.parseStream=function(t){var r=this;return new Ue(t,function(t,e){return r.parseToken(t,e)})};var dr=gr;function gr(t){this.liquid=t}Wt={parse:function(t){var e=new Ce(t.args,this.liquid.options.operatorsTrie);this.key=e.readIdentifier().content,e.skipBlank(),O("="===e.peek(),function(){return"illegal token ".concat(t.getText())}),e.advance(),this.value=e.remaining()},render:function(e){var r,n;return x(this,function(t){switch(t.label){case 0:return r=e.bottom(),n=this.key,[4,this.liquid._evalValue(this.value,e)];case 1:return r[n]=t.sent(),[2]}})}};function vr(e){return w(e)?e:g(e)&&0<e.length?[e]:E(e)?Object.keys(e).map(function(t){return[t,e[t]]}):[]}function yr(t){return w(t)?t:[t]}t(wr,mr=a),wr.prototype.next=function(){this.i++},wr.prototype.index0=function(){return this.i},wr.prototype.index=function(){return this.i+1},wr.prototype.first=function(){return 0===this.i},wr.prototype.last=function(){return this.i===this.length-1},wr.prototype.rindex=function(){return this.length-this.i},wr.prototype.rindex0=function(){return this.length-this.i-1},wr.prototype.valueOf=function(){return JSON.stringify(this)};var mr,br=wr;function wr(t){var e=mr.call(this)||this;return e.i=0,e.length=t,e}Zt={type:"block",parse:function(t,e){var r,n=this,i=new Ce(t.args,this.liquid.options.operatorsTrie),o=i.readIdentifier(),s=i.readIdentifier(),a=i.readValue(),u=(O(o.size()&&"in"===s.content&&a,function(){return"illegal tag: ".concat(t.getText())}),this.variable=o.content,this.collection=a,this.hash=new Je(i.remaining()),this.templates=[],this.elseTemplates=[],this.liquid.parser.parseStream(e).on("start",function(){return r=n.templates}).on("tag:else",function(){return r=n.elseTemplates}).on("tag:endfor",function(){return u.stop()}).on("template",function(t){return r.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}));u.start()},render:function(e,r){var n,i,h,o,s,a,u,c,l,p;return x(this,function(t){switch(t.label){case 0:return n=this.liquid.renderer,h=vr,[4,S(this.collection,e)];case 1:return(i=h.apply(void 0,[t.sent()])).length?[3,3]:[4,n.renderTemplates(this.elseTemplates,e,r)];case 2:return t.sent(),[2];case 3:return[4,this.hash.render(e)];case 4:c=t.sent(),o=c.offset||0,u=void 0===c.limit?i.length:c.limit,i=i.slice(o,o+u),"reversed"in c&&i.reverse(),o={forloop:new br(i.length)},e.push(o),t.label=5;case 5:t.trys.push([5,10,11,12]),s=R(i),a=s.next(),t.label=6;case 6:return a.done?[3,9]:(u=a.value,o[this.variable]=u,[4,n.renderTemplates(this.templates,e,r)]);case 7:if(t.sent(),r.break)return r.break=!1,[3,9];r.continue=!1,o.forloop.next(),t.label=8;case 8:return a=s.next(),[3,6];case 9:return[3,12];case 10:return c=t.sent(),l={error:c},[3,12];case 11:try{a&&!a.done&&(p=s.return)&&p.call(s)}finally{if(l)throw l.error}return[7];case 12:return e.pop(),[2]}})}},Kt={parse:function(t,e){var r=this,n=new Ce(t.args,this.liquid.options.operatorsTrie),i=(this.variable=function(t){var e=t.readIdentifier().content;if(e)return e;e=t.readQuoted();return e?Ve(e):void 0}(n),O(this.variable,function(){return"".concat(t.args," not valid identifier")}),this.templates=[],this.liquid.parser.parseStream(e));i.on("tag:endcapture",function(){return i.stop()}).on("template",function(t){return r.templates.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}),i.start()},render:function(e){var r;return x(this,function(t){switch(t.label){case 0:return[4,this.liquid.renderer.renderTemplates(this.templates,e)];case 1:return r=t.sent(),e.bottom()[this.variable]=r,[2]}})}};var Tr,kr={parse:function(t,e){var n=this,i=(this.cond=new Ge(t.args,this.liquid),this.cases=[],this.elseTemplates=[],[]),r=this.liquid.parser.parseStream(e).on("tag:when",function(t){i=[];for(var e=new Ce(t.args,n.liquid.options.operatorsTrie);!e.end();){var r=e.readValue();r&&n.cases.push({val:r,templates:i}),e.readTo(",")}}).on("tag:else",function(){return i=n.elseTemplates}).on("tag:endcase",function(){return r.stop()}).on("template",function(t){return i.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))});r.start()},render:function(e,r){var n,i,o,s,a,u,c,l;return x(this,function(t){switch(t.label){case 0:return n=this.liquid.renderer,o=y,[4,this.cond.value(e,e.opts.lenientIf)];case 1:i=o.apply(void 0,[t.sent()]),t.label=2;case 2:t.trys.push([2,7,8,9]),s=R(this.cases),a=s.next(),t.label=3;case 3:return a.done?[3,6]:(u=a.value,S(u.val,e,e.opts.lenientIf)!==i?[3,5]:[4,n.renderTemplates(u.templates,e,r)]);case 4:return t.sent(),[2];case 5:return a=s.next(),[3,3];case 6:return[3,9];case 7:return u=t.sent(),c={error:u},[3,9];case 8:try{a&&!a.done&&(l=s.return)&&l.call(s)}finally{if(c)throw c.error}return[7];case 9:return[4,n.renderTemplates(this.elseTemplates,e,r)];case 10:return t.sent(),[2]}})}},xr={parse:function(t,e){var r=this.liquid.parser.parseStream(e);r.on("token",function(t){"endcomment"===t.name&&r.stop()}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}),r.start()}},Or=((Sr=qr=qr||{})[Sr.OUTPUT=0]="OUTPUT",Sr[Sr.STORE=1]="STORE",qr),Sr={parse:function(t){var e=t.args,e=new Ce(e,this.liquid.options.operatorsTrie),r=(this.file=this.liquid.options.dynamicPartials?e.readValue():e.readFileName(),O(this.file,function(){return'illegal argument "'.concat(t.args,'"')}),e.p);"with"===e.readIdentifier().content?(e.skipBlank(),":"!==e.peek()?this.withVar=e.readValue():e.p=r):e.p=r,this.hash=new Je(e.remaining())},render:function(e,h){var r,n,i,o,s,a,u,c,p,l,f;return x(this,function(t){switch(t.label){case 0:return r=(s=this).liquid,n=s.hash,i=s.withVar,o=s.file,s=r.renderer,e.opts.dynamicPartials?Rt(o)?[4,s.renderTemplates(r.parse(Ve(o)),e)]:[3,2]:[3,5];case 1:return c=t.sent(),[3,4];case 2:return[4,S(o,e)];case 3:c=t.sent(),t.label=4;case 4:return u=c,[3,6];case 5:u=o.getText(),t.label=6;case 6:return O(a=u,function(){return'illegal filename "'.concat(o.getText(),'":"').concat(a,'"')}),p=e.saveRegister("blocks","blockMode"),e.setRegister("blocks",{}),e.setRegister("blockMode",Or.OUTPUT),[4,n.render(e)];case 7:return l=t.sent(),i&&(l[a]=S(i,e)),[4,r._parseFile(a,e.opts,e.sync)];case 8:return f=t.sent(),e.push(l),[4,s.renderTemplates(f,e,h)];case 9:return t.sent(),e.pop(),e.restoreRegister(p),[2]}})}},qr={parse:function(t){var e=t.args,r=new Ce(e,this.liquid.options.operatorsTrie);for(this.file=this.liquid.options.dynamicPartials?r.readValue():r.readFileName(),O(this.file,function(){return'illegal argument "'.concat(t.args,'"')});!r.end();){r.skipBlank();var n=r.p,i=r.readIdentifier();if(("with"===i.content||"for"===i.content)&&(r.skipBlank(),":"!==r.peek())){var o=r.readValue();if(o){var s=r.p,a=void 0;"as"===r.readIdentifier().content?a=r.readIdentifier():r.p=s,this[i.content]={value:o,alias:a&&a.content},r.skipBlank(),","===r.peek()&&r.advance();continue}}r.p=n;break}this.hash=new Je(r.remaining())},render:function(e,h){var r,n,i,p,o,f,d,g,v,s,a,y,u,c,m,l,b,w,T,k;return x(this,function(t){switch(t.label){case 0:return r=(i=this).liquid,n=i.file,i=i.hash,p=r.renderer,e.opts.dynamicPartials?Rt(n)?[4,p.renderTemplates(r.parse(Ve(n)),e)]:[3,2]:[3,4];case 1:return d=t.sent(),[3,3];case 2:d=S(n,e),t.label=3;case 3:return f=d,[3,5];case 4:f=n.getText(),t.label=5;case 5:O(o=f,function(){return'illegal filename "'.concat(n.getText(),'":"').concat(o,'"')}),s={};try{g=e.environments.themeConfig||{sections:[]},g.sections,v=function(t,e){var r={};for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}(g,["sections"]),s=q(q({},e.environments),{settings:v})}catch(t){console.error("ctx.environments.themeConfig 解构失败",t)}return s=new bt(s,e.opts,e.sync),[4,i.render(e)];case 6:if(a=t.sent(),this.with&&(u=this.with,y=u.value,u=u.alias,a[u||o]=S(y,e)),s.push(a),!this.for)return[3,16];c=this.for,y=c.value,u=c.alias,c=vr(c=S(y,e)),a.forloop=new br(c.length),t.label=7;case 7:t.trys.push([7,13,14,15]),m=R(c),l=m.next(),t.label=8;case 8:return l.done?[3,12]:(b=l.value,a[u]=b,[4,r._parseFile(o,s.opts,s.sync)]);case 9:return w=t.sent(),[4,p.renderTemplates(w,s,h)];case 10:t.sent(),a.forloop.next(),t.label=11;case 11:return l=m.next(),[3,8];case 12:return[3,15];case 13:return b=t.sent(),T={error:b},[3,15];case 14:try{l&&!l.done&&(k=m.return)&&k.call(m)}finally{if(T)throw T.error}return[7];case 15:return[3,19];case 16:return[4,r._parseFile(o,s.opts,s.sync)];case 17:return w=t.sent(),[4,p.renderTemplates(w,s,h)];case 18:t.sent(),t.label=19;case 19:return[2]}})}},Rr={parse:function(t){t=new Ce(t.args,this.liquid.options.operatorsTrie);this.variable=t.readIdentifier().content},render:function(t,e){t=t.environments;m(t[this.variable])||(t[this.variable]=0),e.write(n(--t[this.variable]))}},Er={parse:function(t){var e=new Ce(t.args,this.liquid.options.operatorsTrie),r=e.readValue();for(e.skipBlank(),this.candidates=[],r&&(":"===e.peek()?(this.group=r,e.advance()):this.candidates.push(r));!e.end();){var n=e.readValue();n&&this.candidates.push(n),e.readTo(",")}O(this.candidates.length,function(){return"empty candidates: ".concat(t.getText())})},render:function(t,e){var r=S(this.group,t),r="cycle:".concat(r,":")+this.candidates.join(","),n=t.getRegister("cycle"),i=(void 0===(o=n[r])&&(o=n[r]=0),this.candidates[o]),o=(o+1)%this.candidates.length,n=(n[r]=o,S(i,t));e.write(n)}},Lr={parse:function(t,e){var r,n=this,i=(this.branches=[],this.elseTemplates=[],this.liquid.parser.parseStream(e).on("start",function(){return n.branches.push({cond:new Ge(t.args,n.liquid),templates:r=[]})}).on("tag:elsif",function(t){n.branches.push({cond:new Ge(t.args,n.liquid),templates:r=[]})}).on("tag:else",function(){return r=n.elseTemplates}).on("tag:else-",function(){return r=n.elseTemplates}).on("tag:endif",function(){return i.stop()}).on("tag:endif-",function(){return i.stop()}).on("template",function(t){return r.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}));i.start()},render:function(e,r){var n,i,o,s,a,u;return x(this,function(t){switch(t.label){case 0:n=this.liquid.renderer,t.label=1;case 1:t.trys.push([1,7,8,9]),i=R(this.branches),o=i.next(),t.label=2;case 2:return o.done?[3,6]:[4,(s=o.value).cond.value(e,e.opts.lenientIf)];case 3:return H(t.sent(),e)?[4,n.renderTemplates(s.templates,e,r)]:[3,5];case 4:return t.sent(),[2];case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return a=t.sent(),a={error:a},[3,9];case 8:try{o&&!o.done&&(u=i.return)&&u.call(i)}finally{if(a)throw a.error}return[7];case 9:return[4,n.renderTemplates(this.elseTemplates,e,r)];case 10:return t.sent(),[2]}})}},Fr={parse:function(t){t=new Ce(t.args,this.liquid.options.operatorsTrie);this.variable=t.readIdentifier().content},render:function(t,e){var t=t.environments,r=(m(t[this.variable])||(t[this.variable]=0),t[this.variable]);t[this.variable]++,e.write(n(r))}},Dr={parse:function(t,e){var r=new Ce(t.args,this.liquid.options.operatorsTrie),n=this.liquid.options.dynamicPartials?r.readValue():r.readFileName();O(n,function(){return'illegal argument "'.concat(t.args,'"')}),this.file=n,this.hash=new Je(r.remaining()),this.tpls=this.liquid.parser.parse(e)},render:function(e,r){var n,i,o,s,a,u,c,h,p,l,f,d,g;return x(this,function(t){switch(t.label){case 0:return(n=(s=this).liquid,i=s.hash,o=s.file,s=n.renderer,"none"!==o.getText())?[3,2]:(e.setRegister("blockMode",Or.OUTPUT),[4,s.renderTemplates(this.tpls,e)]);case 1:return l=t.sent(),r.write(l),[2];case 2:return e.opts.dynamicPartials?Rt(o)?[4,s.renderTemplates(n.parse(Ve(o)),e)]:[3,4]:[3,6];case 3:return c=t.sent(),[3,5];case 4:c=S(this.file,e),t.label=5;case 5:return u=c,[3,7];case 6:u=o.getText(),t.label=7;case 7:return O(a=u,function(){return'file "'.concat(o.getText(),'"("').concat(a,'") not available')}),[4,n._parseFile(a,e.opts,e.sync)];case 8:return h=t.sent(),e.setRegister("blockMode",Or.STORE),[4,s.renderTemplates(this.tpls,e)];case 9:return p=t.sent(),void 0===(l=e.getRegister("blocks"))[""]&&(l[""]=function(){return p}),e.setRegister("blockMode",Or.OUTPUT),d=(f=e).push,[4,i.render(e)];case 10:return d.apply(f,[t.sent()]),[4,s.renderTemplates(h,e)];case 11:return g=t.sent(),e.pop(),r.write(g),[2]}})}},Mr=(t(Pr,Tr=a),Pr.prototype.super=function(){return this.superBlockRender()},Pr);function Pr(t){void 0===t&&(t=function(){return""});var e=Tr.call(this)||this;return e.superBlockRender=t,e}var Nr,Ar={parse:function(t,e){var r=this,n=/\w+/.exec(t.args),i=(this.block=n?n[0]:"",this.tpls=[],this.liquid.parser.parseStream(e).on("tag:endblock",function(){return i.stop()}).on("template",function(t){return r.tpls.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}));i.start()},render:function(e,r){var n;return x(this,function(t){switch(t.label){case 0:return n=this.getBlockRender(e),[4,this.emitHTML(e,r,n)];case 1:return t.sent(),[2]}})},getBlockRender:function(n){function e(e){var r;return x(this,function(t){switch(t.label){case 0:return n.push({block:e}),[4,i.renderer.renderTemplates(o,n)];case 1:return r=t.sent(),n.pop(),[2,r]}})}var i=this.liquid,o=this.tpls,r=n.getRegister("blocks")[this.block];return r?function(t){return r(new Mr(function(){return e(t)}))}:e},emitHTML:function(e,r,n){var i,o;return x(this,function(t){switch(t.label){case 0:return e.getRegister("blockMode",Or.OUTPUT)!==Or.STORE?[3,1]:(e.getRegister("blocks")[this.block]=n,[3,3]);case 1:return o=(i=r).write,[4,n(new Mr)];case 2:o.apply(i,[t.sent()]),t.label=3;case 3:return[2]}})}},_r={parse:function(t,e){var r=this,n=(this.tokens=[],this.liquid.parser.parseStream(e));n.on("token",function(t){"endraw"===t.name?n.stop():r.tokens.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}),n.start()},render:function(){return this.tokens.map(function(t){return t.getText()}).join("")}},Ir=(t(jr,Nr=br),jr.prototype.row=function(){return Math.floor(this.i/this.cols)+1},jr.prototype.col0=function(){return this.i%this.cols},jr.prototype.col=function(){return this.col0()+1},jr.prototype.col_first=function(){return 0===this.col0()},jr.prototype.col_last=function(){return this.col()===this.cols},jr);function jr(t,e){var r=Nr.call(this,t)||this;return r.length=t,r.cols=e,r}var Vr={assign:Wt,for:Zt,capture:Kt,case:kr,comment:xr,include:Sr,render:qr,decrement:Rr,increment:Fr,cycle:Er,if:Lr,layout:Dr,block:Ar,raw:_r,tablerow:{parse:function(t,e){var r,n=this,i=new Ce(t.args,this.liquid.options.operatorsTrie),o=(this.variable=i.readIdentifier(),i.skipBlank(),i.readIdentifier()),s=(O(o&&"in"===o.content,function(){return"illegal tag: ".concat(t.getText())}),this.collection=i.readValue(),this.hash=new Je(i.remaining()),this.templates=[],this.liquid.parser.parseStream(e).on("start",function(){return r=n.templates}).on("tag:endtablerow",function(){return s.stop()}).on("template",function(t){return r.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}));s.start()},render:function(e,r){var n,i,o,s,a,u;return x(this,function(t){switch(t.label){case 0:return i=vr,[4,S(this.collection,e)];case 1:return n=i.apply(void 0,[t.sent()]),[4,this.hash.render(e)];case 2:s=t.sent(),a=s.offset||0,o=void 0===s.limit?n.length:s.limit,n=n.slice(a,a+o),a=s.cols||n.length,o=this.liquid.renderer,s=new Ir(n.length,a),a={tablerowloop:s},e.push(a),u=0,t.label=3;case 3:return u<n.length?(a[this.variable.content]=n[u],0===s.col0()&&(1!==s.row()&&r.write("</tr>"),r.write('<tr class="row'.concat(s.row(),'">'))),r.write('<td class="col'.concat(s.col(),'">')),[4,o.renderTemplates(this.templates,e,r)]):[3,6];case 4:t.sent(),r.write("</td>"),t.label=5;case 5:return u++,s.next(),[3,3];case 6:return n.length&&r.write("</tr>"),e.pop(),[2]}})}},unless:{parse:function(t,e){var r,n=this,i=(this.templates=[],this.branches=[],this.elseTemplates=[],this.liquid.parser.parseStream(e).on("start",function(){r=n.templates,n.cond=new Ge(t.args,n.liquid)}).on("tag:elsif",function(t){n.branches.push({cond:new Ge(t.args,n.liquid),templates:r=[]})}).on("tag:else",function(){return r=n.elseTemplates}).on("tag:endunless",function(){return i.stop()}).on("template",function(t){return r.push(t)}).on("end",function(){throw new Error("tag ".concat(t.getText()," not closed"))}));i.start()},render:function(e,r){var n,i,o,s,a,u;return x(this,function(t){switch(t.label){case 0:return n=this.liquid.renderer,[4,this.cond.value(e,e.opts.lenientIf)];case 1:return K(t.sent(),e)?[4,n.renderTemplates(this.templates,e,r)]:[3,3];case 2:return t.sent(),[2];case 3:t.trys.push([3,9,10,11]),i=R(this.branches),o=i.next(),t.label=4;case 4:return o.done?[3,8]:[4,(s=o.value).cond.value(e,e.opts.lenientIf)];case 5:return H(t.sent(),e)?[4,n.renderTemplates(s.templates,e,r)]:[3,7];case 6:return t.sent(),[2];case 7:return o=i.next(),[3,4];case 8:return[3,11];case 9:return a=t.sent(),a={error:a},[3,11];case 10:try{o&&!o.done&&(u=i.return)&&u.call(i)}finally{if(a)throw a.error}return[7];case 11:return[4,n.renderTemplates(this.elseTemplates,e,r)];case 12:return t.sent(),[2]}})}},break:{render:function(t,e){e.break=!0}},continue:{render:function(t,e){e.continue=!0}}},Cr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},zr={"&amp;":"&","&lt;":"<","&gt;":">","&#34;":'"',"&#39;":"'"};function Br(t){return n(t).replace(/&|<|>|"|'/g,function(t){return Cr[t]})}Wt=Math.abs,Zt=Math.max,Kt=Math.min,kr=Math.ceil,xr=Math.floor;var Hr=/%([-_0^#:]+)?(\d+)?([EO])?(.)/,Kr=["January","February","March","April","May","June","July","August","September","October","November","December"],Ur=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Qr=Kr.map(Yr),Wr=Ur.map(Yr),Jr={1:"st",2:"nd",3:"rd",default:"th"};function Yr(t){return t.slice(0,3)}function Zr(t){return[31,function(t){t=t.getFullYear();return!(0!=(3&t)||!(t%100||t%400==0&&t))}(t)?29:28,31,30,31,30,31,31,30,31,30,31]}function $r(t){for(var e=0,r=0;r<t.getMonth();++r)e+=Zr(t)[r];return e+t.getDate()}function Gr(t,e){var r=$r(t)+(e-t.getDay()),t=7-new Date(t.getFullYear(),0,1).getDay()+e;return String(Math.floor((r-t)/7)+1)}var Xr={d:2,e:2,H:2,I:2,j:3,k:2,l:2,L:3,m:2,M:2,S:2,U:2,W:2},tn={a:" ",A:" ",b:" ",B:" ",c:" ",e:" ",k:" ",l:" ",p:" ",P:" "},en={a:function(t){return Wr[t.getDay()]},A:function(t){return Ur[t.getDay()]},b:function(t){return Qr[t.getMonth()]},B:function(t){return Kr[t.getMonth()]},c:function(t){return t.toLocaleString()},C:function(t){return parseInt(t.getFullYear().toString().substring(0,2),10)},d:function(t){return t.getDate()},e:function(t){return t.getDate()},H:function(t){return t.getHours()},I:function(t){return String(t.getHours()%12||12)},j:$r,k:function(t){return t.getHours()},l:function(t){return String(t.getHours()%12||12)},L:function(t){return t.getMilliseconds()},m:function(t){return t.getMonth()+1},M:function(t){return t.getMinutes()},N:function(t,e){e=Number(e.width)||9;return D(String(t.getMilliseconds()).substr(0,e),e,t=void 0===(t="0")?" ":t,function(t,e){return t+e})},p:function(t){return t.getHours()<12?"AM":"PM"},P:function(t){return t.getHours()<12?"am":"pm"},q:function(t){return t=(t=t).getDate().toString(),t=parseInt(t.slice(-1)),Jr[t]||Jr.default},s:function(t){return Math.round(t.valueOf()/1e3)},S:function(t){return t.getSeconds()},u:function(t){return t.getDay()||7},U:function(t){return Gr(t,0)},w:function(t){return t.getDay()},W:function(t){return Gr(t,1)},x:function(t){return t.toLocaleDateString()},X:function(t){return t.toLocaleTimeString()},y:function(t){return t.getFullYear().toString().substring(2,4)},Y:function(t){return t.getFullYear()},z:function(t,e){var t=t.getTimezoneOffset(),r=Math.abs(t),n=r%60;return(0<t?"-":"+")+F(Math.floor(r/60),2,"0")+(e.flags[":"]?":":"")+F(n,2,"0")},t:function(){return"\t"},n:function(){return"\n"},"%":function(){return"%"}};function rn(t,e){for(var r,n=t,i=(t instanceof on&&(n=t.getDisplayDate()),""),o=e;r=Hr.exec(o);)i+=o.slice(0,r.index),o=o.slice(r.index+r[0].length),i+=function(l,t){var e,t=f(t,5),r=t[0],n=t[1],n=void 0===n?"":n,i=t[2],h=t[3],t=t[4],o=en[t];if(!o)return r;var s={};try{for(var a=R(n),u=a.next();!u.done;u=a.next()){var p=u.value;s[p]=!0}}catch(t){e={error:t}}finally{try{u&&!u.done&&(c=a.return)&&c.call(a)}finally{if(e)throw e.error}}var r=String(o(l,{flags:s,width:i,modifier:h})),n=tn[t]||"0",c=i||Xr[t]||0;s["^"]?r=r.toUpperCase():s["#"]&&(r=function(t){return d([],f(t),!1).some(function(t){return"a"<=t&&t<="z"})?t.toUpperCase():t.toLowerCase()}(r));s._?n=" ":s[0]&&(n="0");s["-"]&&(c=0);return F(r,c,n)}(n,r);return i+o}en.h=en.b;t(sn,nn=Date),sn.prototype.getDisplayDate=function(){return new Date(+this+60*this.inputTimezoneOffset*1e3)};var nn,on=sn;function sn(t){var e,r,n=nn.call(this,t)||this,t=(n.dateString=t,n.ISO8601_TIMEZONE_PATTERN=/([zZ]|([+-])(\d{2}):(\d{2}))$/,n.inputTimezoneOffset=0,t.match(n.ISO8601_TIMEZONE_PATTERN));return t&&"Z"===t[1]?n.inputTimezoneOffset=n.getTimezoneOffset():t&&t[2]&&t[3]&&t[4]&&(r=(t=f(t,5))[2],e=t[3],t=t[4],r=("+"===r?1:-1)*(60*parseInt(e,10)+parseInt(t,10)),n.inputTimezoneOffset=n.getTimezoneOffset()+r),n}var an=Object.freeze({__proto__:null,escape:Br,escapeOnce:function(t){return Br(String(t).replace(/&(amp|lt|gt|#34|#39);/g,function(t){return zr[t]}))},newlineToBr:function(t){return t.replace(/\n/g,"<br />\n")},stripHtml:function(t){return t.replace(/<script.*?<\/script>|<!--.*?-->|<style.*?<\/style>|<.*?>/g,"")},abs:Wt,atLeast:Zt,atMost:Kt,ceil:kr,dividedBy:function(t,e){return t/e},floor:xr,minus:function(t,e){return t-e},modulo:function(t,e){return t%e},times:function(t,e){return t*e},round:function(t,e){return void 0===e&&(e=0),e=Math.pow(10,e),Math.round(t*e)/e},plus:function(t,e){return Number(t)+Number(e)},sortNatural:function(t,r){return t&&t.sort?void 0!==r?d([],f(t),!1).sort(function(t,e){return N(t[r],e[r])}):d([],f(t),!1).sort(N):[]},urlDecode:function(t){return t.split("+").map(decodeURIComponent).join(" ")},urlEncode:function(t){return t.split(" ").map(encodeURIComponent).join("+")},join:function(t,e){return t.join(void 0===e?" ":e)},last:function(t){return w(t)?k(t):""},first:function(t){return w(t)?t[0]:""},reverse:function(t){return d([],f(t),!1).reverse()},sort:function(t,e){function r(t){return e?n.context.getFromScope(t,e.split(".")):t}var n=this;return yr(t).sort(function(t,e){return(t=r(t))<(e=r(e))?-1:e<t?1:0})},size:function(t){return t&&t.length||0},map:function(t,e){var r=this;return yr(t).map(function(t){return r.context.getFromScope(t,e.split("."))})},compact:function(t){return yr(t).filter(function(t){return!b(t)})},concat:function(t,e){return yr(t).concat(e)},slice:function(t,e,r){return e=e<0?t.length+e:e,t.slice(e,e+(r=void 0===r?1:r))},where:function(t,e,r){var n=this;return yr(t).filter(function(t){t=n.context.getFromScope(t,String(e).split("."));return void 0===r?H(t,n.context):t===r})},uniq:function(t){var e={};return(t||[]).filter(function(t){return!e.hasOwnProperty(String(t))&&(e[String(t)]=!0)})},date:function(t,e){var r,n=t;return"now"===t||"today"===t?n=new Date:m(t)?n=new Date(1e3*t):g(t)&&(n=/^\d+$/.test(t)?new Date(1e3*+t):new(this.context.opts.preserveTimezones?on:Date)(t)),(r=n)instanceof Date&&!isNaN(r.getTime())?rn(n,e):t},Default:function(t,e){return w(t)||g(t)?t.length?t:e:K(y(t),this.context)?e:t},json:function(t){return JSON.stringify(t)},append:function(t,e){return O(2===arguments.length,function(){return"append expect 2 arguments"}),n(t)+n(e)},prepend:function(t,e){return O(2===arguments.length,function(){return"prepend expect 2 arguments"}),n(e)+n(t)},lstrip:function(t){return n(t).replace(/^\s+/,"")},downcase:function(t){return n(t).toLowerCase()},upcase:function(t){return n(t).toUpperCase()},remove:function(t,e){return n(t).split(String(e)).join("")},removeFirst:function(t,e){return n(t).replace(String(e),"")},rstrip:function(t){return n(t).replace(/\s+$/,"")},split:function(t,e){return n(t).split(String(e))},strip:function(t){return n(t).trim()},stripNewlines:function(t){return n(t).replace(/\n/g,"")},capitalize:function(t){return(t=n(t)).charAt(0).toUpperCase()+t.slice(1).toLowerCase()},replace:function(t,e,r){return n(t).split(String(e)).join(r)},replaceFirst:function(t,e,r){return n(t).replace(String(e),r)},truncate:function(t,e,r){return void 0===e&&(e=50),void 0===r&&(r="..."),(t=n(t)).length<=e?t:t.substr(0,e-r.length)+r},truncatewords:function(t,e,r){void 0===e&&(e=15),void 0===r&&(r="...");var n=(t=t.split(/\s+/)).slice(0,e).join(" ");return t.length>=e&&(n+=r),n}}),un=(cn.prototype.get=function(t){var e=this.impls[t];return O(e,function(){return'tag "'.concat(t,'" not found')}),e},cn.prototype.set=function(t,e){this.impls[t]=e},cn);function cn(){this.impls={}}hn.prototype.get=function(t){var e=this.impls[t];return O(e||!this.strictFilters,function(){return"undefined filter: ".concat(t)}),e},hn.prototype.set=function(t,e){this.impls[t]=e},hn.prototype.create=function(t,e){return new Ze(t,this.get(t),e,this.liquid)};var ln=hn;function hn(t,e){this.strictFilters=t,this.liquid=e,this.impls={}}i.prototype.parse=function(t,e){t=new Ce(t,this.options.operatorsTrie,e).readTopLevelTokens(this.options);return this.parser.parse(t)},i.prototype._render=function(t,e,r,n){r=q(q({},this.options),$(r)),e=new bt(e,r,n),n=new ze(r.keepOutputType);return this.renderer.renderTemplates(t,e,n)},i.prototype.render=function(e,r,n){return s(this,void 0,void 0,function(){return x(this,function(t){return[2,nr(this._render(e,r,n,!1))]})})},i.prototype.renderSync=function(t,e,r){return ir(this._render(t,e,r,!0))},i.prototype._parseAndRender=function(t,e,r,n){t=this.parse(t);return this._render(t,e,r,n)},i.prototype.parseAndRender=function(e,r,n){return s(this,void 0,void 0,function(){return x(this,function(t){return[2,nr(this._parseAndRender(e,r,n,!1))]})})},i.prototype.parseAndRenderSync=function(t,e,r){return ir(this._parseAndRender(t,e,r,!0))},i.prototype._parseFile=function(e,h,p){var r,n,i,o,s,a,u,c,f,d,l,g;return x(this,function(t){switch(t.label){case 0:r=q(q({},this.options),$(h)),n=r.root.map(function(t){return r.fs.resolve(t,e,r.extname)}),void 0!==r.fs.fallback&&void 0!==(s=r.fs.fallback(e))&&n.push(s),t.label=1;case 1:t.trys.push([1,13,14,15]),i=R(n),o=i.next(),t.label=2;case 2:return o.done?[3,12]:(s=o.value,(a=r.cache)?[4,a.read(s)]:[3,4]);case 3:if(c=t.sent())return[2,c];t.label=4;case 4:return p?(u=r.fs.existsSync(s),[3,7]):[3,5];case 5:return[4,r.fs.exists(s)];case 6:u=t.sent(),t.label=7;case 7:return u?(f=this.parse,p?(d=r.fs.readFileSync(s),[3,10]):[3,8]):[3,11];case 8:return[4,r.fs.readFile(s)];case 9:d=t.sent(),t.label=10;case 10:return c=f.apply(this,[d,s]),a&&a.write(s,c),[2,c];case 11:return o=i.next(),[3,2];case 12:return[3,15];case 13:return l=t.sent(),l={error:l},[3,15];case 14:try{o&&!o.done&&(g=i.return)&&g.call(i)}finally{if(l)throw l.error}return[7];case 15:throw this.lookupError(e,r.root)}})},i.prototype.parseFile=function(e,r){return s(this,void 0,void 0,function(){return x(this,function(t){return[2,nr(this._parseFile(e,r,!1))]})})},i.prototype.parseFileSync=function(t,e){return ir(this._parseFile(t,e,!0))},i.prototype.renderFile=function(r,n,i){return s(this,void 0,void 0,function(){var e;return x(this,function(t){switch(t.label){case 0:return[4,this.parseFile(r,i)];case 1:return e=t.sent(),[2,this.render(e,n,i)]}})})},i.prototype.renderFileSync=function(t,e,r){t=this.parseFileSync(t,r);return this.renderSync(t,e,r)},i.prototype._evalValue=function(t,e){return new Ge(t,this).value(e,!1)},i.prototype.evalValue=function(e,r){return s(this,void 0,void 0,function(){return x(this,function(t){return[2,nr(this._evalValue(e,r))]})})},i.prototype.evalValueSync=function(t,e){return ir(this._evalValue(t,e))},i.prototype.registerFilter=function(t,e){this.filters.set(t,e)},i.prototype.registerTag=function(t,e){this.tags.set(t,e)},i.prototype.plugin=function(t){return t.call(this,i)},i.prototype.express=function(){var i=this;return function(t,e,r){var n={root:d(d([],f(G(this.root)),!1),f(i.options.root),!1)};i.renderFile(t,e,n).then(function(t){return r(null,t)},r)}},i.prototype.lookupError=function(t,e){var r=new Error("ENOENT");return r.message='ENOENT: Failed to lookup "'.concat(t,'" in "').concat(e,'"'),r.code="ENOENT",r},i.prototype.getTemplate=function(e,r){return s(this,void 0,void 0,function(){return x(this,function(t){return[2,this.parseFile(e,r)]})})},i.prototype.getTemplateSync=function(t,e){return this.parseFileSync(t,e)};Sr=i;function i(t){var r=this;this.options=(t=$(t=void 0===t?{}:t),q(q({},Z),t)),this.parser=new dr(this),this.renderer=new He,this.filters=new ln(this.options.strictFilters,this),this.tags=new un,T(Vr,function(t,e){return r.registerTag(P(e),t)}),T(an,function(t,e){return r.registerFilter(P(e),t)})}l.AssertionError=yt,l.Context=bt,l.Drop=a,l.Emitter=ze,l.Expression=Ie,l.Hash=Je,l.InternalUndefinedVariableError=dt,l.Liquid=Sr,l.LiquidError=z,l.ParseError=ot,l.ParseStream=Ue,l.RenderError=ut,l.TagToken=Le,l.Token=At,l.TokenizationError=rt,l.Tokenizer=Ce,l.TypeGuards=e,l.UndefinedVariableError=ht,l.Value=Ge,l.assert=O,l.createTrie=Y,l.defaultOperators=U,l.evalQuotedToken=Ve,l.evalToken=S,l.isFalsy=K,l.isTruthy=H,l.toPromise=nr,l.toThenable=rr,l.toValue=y,Object.defineProperty(l,"__esModule",{value:!0})});
//# sourceMappingURL=liquid.browser.min.js.map
